
---
title: "Transfer lifecycle"
---

This document describes transfer from Alice's account to Bob's account.

# Notarize transaction

Alice initiate a transfer by sending a signed message `notarizeTransaction` to the Notary.
The message contains `accountLedger` document and it contains one `transaction` type `transfer`.

The transaction contains two items

* `transfer`
  * contains information from which account to which account is transfer
* `balanceStatement`
  * contains proposal about the balance and transaction/issued numbers if the transfer is successful

Everything is signed by Alice.

# Alice initialize transfer

Notary responds with message `@notarizeTransactions`. It contains `accountLedger` with transaction type `atTransfer` (response to transaction `transfer`). The transaction contains response for each item. The items' status is `acknowledgement` or `rejection`.

* `atBalanceStatement`
  * contains attribute `outboxNewTransNum` that contains number of new transaction that the Notary dropped to Alice's outbox and Bob's inbox.
* `atTransfer`

Both items contain in `inReferenceTo` whole copy of original item. The response item is signed by the Notary to prove that Notary agreed with that. Both items have set `inReferenceTo`, `numberOfOrigin` and `transactionNum` to origin Alice's transaction number.

When Notary accepts Alice's transaction the Notary creates new `pending` transaction and put it to Bob's inbox and Alice's outbox.


Alice expects new transaction in outbox so she download it by combination of `getAccountFiles`, `getBoxReceipt`. TODO: why has Alice new copy of transfer

# Bob gets transfer to inbox

The same is done by Bob. By messages `getAccountFiles`, `getBoxReceipt` Bob downloads new receipt from his inbox. The receipt contains `pending` transaction signed by Notary. The transaction contains original Alice's `transfer` with her signature.

Bob accepts the `pending` transaction by new transaction `processInbox` in message `processInbox`. The transaction contains two items

* `acceptPending`
 * `numberOfOrigin` points to original Alice's `transfer`
 * `transactionNum` is new transaction number, same as `processInbox`
 * `inReferenceTo` points to transaction that Bob is responding (generated by Notary after Alice sends `transfer`)
* `balanceStatement` with new propose balance and transaction nums


Notary accepts Bob's `processInbox` and send `atAcceptPending` to Bob in reply. As Bob accepted the transfer Notary generates new transaction `transferReceipt` and drop it into Alice's inbox.


# Alice gets notification that transfer complete

Alice has new `transferReceipt` in her inbox.

* `numberOfOrigin` points to original Alice's `transfer`
* `transactionNum` new transaction num
* `inReferenceTo` points to Bob's `processInbox`
* `inRefDisplay` points to original Alice's `transfer`
* element `inReferenceTo` contains copy of Bob's `acceptPending` with his signature, so Alice has a prove that Bob accepted the transfer and it is also signed by Notary. TODO I do not see in current code, that client check it

Alice response to `transferReceipt` by `acceptItemReceipt` in `processInbox`.

Notary sends `atAcceptItemReceipt`.
