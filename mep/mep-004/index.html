<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">

        <title>4 - Remove Google ProtoBuf Encoding From The Protocol - Protocol docs</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../..">Protocol docs</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Main <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li >
                                <a href="../../DocumentTypes">Document Types</a>
                            </li>
                        
                            <li >
                                <a href="../../Requirements">Requirements</a>
                            </li>
                        
                            <li >
                                <a href="../../Transport">Transport</a>
                            </li>
                        
                            <li >
                                <a href="../../Transfer">Transfer</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Doctype <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li >
                                <a href="../../doctypes/contract">Base Contract</a>
                            </li>
                        
                            <li >
                                <a href="../../doctypes/credentials">Credentials</a>
                            </li>
                        
                            <li >
                                <a href="../../doctypes/notaryProviderContract">notaryProviderContract</a>
                            </li>
                        
                            <li >
                                <a href="../../doctypes/instrumentDefinition">instrumentDefinition</a>
                            </li>
                        
                            <li >
                                <a href="../../doctypes/nymData">nymData</a>
                            </li>
                        
                            <li >
                                <a href="../../doctypes/notaryMessage">notaryMessage</a>
                            </li>
                        
                            <li >
                                <a href="../../doctypes/accountLedger">accountLedger</a>
                            </li>
                        
                            <li >
                                <a href="../../doctypes/transaction">transaction</a>
                            </li>
                        
                            <li >
                                <a href="../../doctypes/item">item</a>
                            </li>
                        
                            <li >
                                <a href="../../doctypes/account">account</a>
                            </li>
                        
                            <li >
                                <a href="../../doctypes/cheque">cheque</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Encoding <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li >
                                <a href="../../encoding/SectionFormat">Section Format</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">MEP <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li >
                                <a href="../mep-001">1 - MEP purpose and guidelines</a>
                            </li>
                        
                            <li >
                                <a href="../mep-002">2 - Use CurveZMQ for encryption and authentication</a>
                            </li>
                        
                            <li >
                                <a href="../mep-003">3 - Document type XML cleanup</a>
                            </li>
                        
                            <li class="active">
                                <a href=".">4 - Remove Google ProtoBuf Encoding From The Protocol</a>
                            </li>
                        
                            <li >
                                <a href="../mep-005">5 - Use ISO8601 for date and time formatting</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                </ul>
            

            
            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
                
                <li >
                    <a rel="next" href="../mep-003">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../mep-005">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                
                <li>
                    <a href="https://github.com/monetas/protocol-docs/">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
            
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#remove-google-protobuf-encoding-from-the-protocol">Remove Google ProtoBuf Encoding From The Protocol</a></li>
        
            <li><a href="#abstract">Abstract</a></li>
        
            <li><a href="#current-status">Current status</a></li>
        
            <li><a href="#drawbacks">Drawbacks</a></li>
        
            <li><a href="#enhancement">Enhancement</a></li>
        
            <li><a href="#impact">Impact</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<table>
<thead>
<tr>
<th>MEP</th>
<th>4</th>
</tr>
</thead>
<tbody>
<tr>
<td>Title</td>
<td>Remove Google ProtoBuf Encoding From The Protocol</td>
</tr>
<tr>
<td>Status</td>
<td>Accepted</td>
</tr>
<tr>
<td>Created</td>
<td>2014-11-18</td>
</tr>
<tr>
<td>Author</td>
<td>Otto Allmendinger</td>
</tr>
</tbody>
</table>
<h1 id="remove-google-protobuf-encoding-from-the-protocol">Remove Google ProtoBuf Encoding From The Protocol</h1>
<h2 id="abstract">Abstract</h2>
<p>In general, all messages sent between Client and Notary should be
human-readable. This helps developers understand and debug message content, and
is necessary in cases where messages or message content needs to be audited by
third parties in case of a dispute.</p>
<p>The protocol should also be as simple as possible and use as few encoding
schemes as necessary.</p>
<p>This MEP suggests the removal of the encoding defined by the Google ProtoBuf
library in order to increase human readability and simplify the protocol.</p>
<h2 id="current-status">Current status</h2>
<p>Open-Transactions uses four different encodings:</p>
<ul>
<li><strong>"Section Format"</strong>. Used at the top level of any signed document. This is
  OpenPGP-inspired format that separates signed content from
  signatures using dashed line markers: <code>-----BEGIN SIGNED CONTRACT-----</code>.</li>
<li><strong>XML</strong>. The document payload is usually encoded using XML. With MEP-3, it
  will be valid XML as well.</li>
<li><strong>ASCII-Armoring</strong>. Used for binary data and lossless embedding of
  sub-documents. This encoding uses three steps.</li>
<li>Pack byte sequence using Protocol Buffers</li>
<li>Use zlib <code>DEFLATE</code> algorithm (strings only)</li>
<li>Encode byte sequence using Base64</li>
<li><strong>Protocol-Buffers</strong>. Used for encoding structured data. Certain data types
  like key-value pairs and market data are encoded into byte sequences using
  Protocol Buffers. (The resulting byte sequence is then encoded using
  ASCII-Armoring as well, where it will be ProtoBuf-encoded as well)</li>
</ul>
<p>Strictly speaking, the use of ProtoBuf is dependent on a compile-time flag that
allows using another "packer" instead of ProtoBuf. This is not used in practice.
Allowing for different packers would make the description of the protocol even
more difficult.</p>
<p>(Side-note: The use of ASCII-Armoring for embedding plain-text data eliminates
human readability and dramatically increases file size after compression. Due to
the difficulty of changing that in the current code, it will be dealt with in a
future MEP)</p>
<h2 id="drawbacks">Drawbacks</h2>
<p>The Google ProtoBuf library is a dependency for any component that wants to read
or write messages or documents in Open-Transactions. Using the library requires
the definitions of the particular data types that are encoded and decode. This
makes reading and writing protocol messages significantly more complex.</p>
<p>ProtoBuf encodes data types into byte sequences, which are not human-readable
and must be radix-encoded when embedded inside an XML document.</p>
<h3 id="protobuf-in-ascii-armoring">ProtoBuf in ASCII-Armoring</h3>
<p>Here, Protocol Buffers are used to encode a byte sequence into another byte
sequence. This is essentially a NOOP that serves no discernible purpose.</p>
<h3 id="protobuf-for-structured-data">ProtoBuf for Structured Data</h3>
<p>Only Section-Format and XML can be described as human-readable. In the case of
binary data (hash values and signature data), radix encoding cannot be avoided
and improve human readability, like base64 encoding of signatures and base58
encoding of hash values. In all other cases, radix encoding decreases human
readability. By encoding structured data using ProtoBuf instead of XML, armoring
must be used and human readability is lost.</p>
<h2 id="enhancement">Enhancement</h2>
<p>The removal of the ProtoBuf from protocol simplifies the complexity of the
protocol and improves human readability in some cases.</p>
<h3 id="remove-protobuf-from-ascii-armoring">Remove ProtoBuf from ASCII-Armoring</h3>
<p>This simplifies the decoding and encoding algorithms for "ASCII-Armored" data.</p>
<h3 id="replace-protobuf-with-xml-for-structured-data">Replace ProtoBuf with XML for Structured Data</h3>
<p>This increases human readability of protocol messages and simplifies encoding
and decoding of document types.</p>
<h2 id="impact">Impact</h2>
<ul>
<li>Removal of the packing stage in the class <code>ASCIIArmor</code>. This is a simple
  change that only requires sample data to be recreated.</li>
<li>Replacement of encoding of complex data types (e.g. Key-Value pairs, Marked
  Data) with XML document types. This requires some design effort, changes
  in the writing/parsing code and recreation of sample data.</li>
</ul>
</div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Monetas 2014, Zug, Switzerland. All rights reserved.</p>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        

        <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/prettify-1.0.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script src="../../js/base.js"></script>
    </body>
</html>